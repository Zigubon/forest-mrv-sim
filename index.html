<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forest MRV Simulator v3.0 [Expert]</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #145A32; --secondary: #2E86C1; --bg: #F4F6F7; --card: #FFFFFF; --text: #2C3E50; }
        body { margin: 0; padding: 0; font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); font-size: 14px; }
        
        .layout { display: grid; grid-template-columns: 340px 1fr; min-height: 100vh; }
        
        /* Left Sidebar: Controls */
        .sidebar { background: var(--card); border-right: 1px solid #ddd; padding: 25px; overflow-y: auto; display: flex; flex-direction: column; }
        .brand { font-size: 1.4rem; font-weight: 800; color: var(--primary); margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        .brand span { font-size: 0.8rem; background: #e8f5e9; padding: 3px 8px; border-radius: 4px; color: var(--primary); }

        .section-title { font-size: 0.85rem; font-weight: 700; color: #999; margin: 20px 0 10px; text-transform: uppercase; letter-spacing: 1px; }
        
        .control-group { margin-bottom: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee; }
        .control-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .control-header label { font-weight: 700; color: var(--text); }
        .btn-mini { background: none; border: none; color: #e74c3c; cursor: pointer; font-size: 0.9rem; }
        
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 8px; }
        .input-row small { grid-column: 1 / -1; color: #666; font-size: 0.75rem; margin-top: -5px; }
        select, input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-family: inherit; }
        
        .btn-add { width: 100%; padding: 10px; border: 2px dashed #bbb; background: white; color: #666; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-add:hover { border-color: var(--primary); color: var(--primary); background: #f0fdf4; }

        .btn-calc { margin-top: auto; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 8px; font-size: 1.1rem; font-weight: 700; cursor: pointer; box-shadow: 0 4px 10px rgba(20, 90, 50, 0.2); transition: 0.2s; }
        .btn-calc:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(20, 90, 50, 0.3); }

        /* Right Content: Dashboard */
        .dashboard { padding: 30px; overflow-y: auto; }
        
        /* KPI Cards */
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 25px; }
        .kpi-card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); border-top: 4px solid var(--secondary); }
        .kpi-label { font-size: 0.85rem; color: #7f8c8d; font-weight: 600; margin-bottom: 5px; }
        .kpi-value { font-size: 1.6rem; font-weight: 800; color: var(--text); }
        .kpi-sub { font-size: 0.8rem; color: #27ae60; margin-top: 5px; display: flex; align-items: center; gap: 5px; }

        /* Charts & Tables */
        .panel { background: var(--card); padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 25px; }
        .panel-header { font-size: 1.1rem; font-weight: 700; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        
        .chart-wrapper { height: 400px; position: relative; }

        /* NDC Progress */
        .ndc-container { background: linear-gradient(145deg, #2c3e50, #34495e); color: white; padding: 25px; border-radius: 12px; margin-bottom: 25px; }
        .ndc-bar-bg { background: rgba(255,255,255,0.1); height: 16px; border-radius: 8px; margin: 15px 0; overflow: hidden; }
        .ndc-bar-fill { height: 100%; background: linear-gradient(90deg, #2ecc71, #27ae60); width: 0%; transition: width 1s; }
        
        /* Analysis Table */
        .data-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .data-table th { text-align: left; padding: 12px; border-bottom: 2px solid #eee; color: #7f8c8d; }
        .data-table td { padding: 12px; border-bottom: 1px solid #f5f5f5; }
        .data-table tr:last-child td { border-bottom: none; }

        @media (max-width: 1200px) { .layout { grid-template-columns: 1fr; } .kpi-grid { grid-template-columns: 1fr 1fr; } }
    </style>
</head>
<body>

<div class="layout">
    <div class="sidebar">
        <div class="brand">
            <i class="fa-solid fa-tree"></i> Forest MRV <span>Pro v3.0</span>
        </div>
        
        <div class="section-title">Project Configuration</div>
        <div style="margin-bottom: 20px;">
            <label style="font-size:0.8rem; font-weight:bold; color:#555;">ğŸ“… ì‚¬ì—… ê¸°ê°„ (Years)</label>
            <input type="number" id="sim-years" value="40" min="20" max="100" style="margin-top:5px;">
        </div>

        <div id="plot-container">
            </div>

        <button class="btn-add" onclick="addPlot()"><i class="fa-solid fa-plus"></i> êµ¬íš(Plot) ì¶”ê°€</button>

        <div class="section-title">Reference Data</div>
        <div style="font-size:0.75rem; color:#888; line-height:1.4;">
            <i class="fa-solid fa-database"></i> <strong>AutomaticCalculator_FM v1.0.11</strong><br>
            - ê³„ìˆ˜: 2023 ìŠ¹ì¸ êµ­ê°€ ì˜¨ì‹¤ê°€ìŠ¤ ê³„ìˆ˜<br>
            - ëª¨ë¸: í˜„ì‹¤ë¦¼ ì„ë¶„ìˆ˜í™•í‘œ (NIFOS 2023)<br>
            - ë°©ë²•ë¡ : ë°”ì´ì˜¤ë§¤ìŠ¤ í™•ì¥ ê³„ìˆ˜ë²•
        </div>

        <button class="btn-calc" onclick="calculateMRV()">
            <i class="fa-solid fa-calculator"></i> ë¶„ì„ ì‹¤í–‰
        </button>
    </div>

    <div class="dashboard">
        <div class="kpi-grid">
            <div class="kpi-card" style="border-top-color: #27ae60;">
                <div class="kpi-label">ì´ ëˆ„ì  íƒ„ì†Œí¡ìˆ˜ëŸ‰ (tCOâ‚‚)</div>
                <div class="kpi-value" id="kpi-total">0</div>
                <div class="kpi-sub"><i class="fa-solid fa-arrow-trend-up"></i> ì „ ê¸°ê°„ í•©ê³„</div>
            </div>
            <div class="kpi-card" style="border-top-color: #3498db;">
                <div class="kpi-label">2035ë…„ ì—°ê°„ í¡ìˆ˜ëŸ‰ (tCOâ‚‚/yr)</div>
                <div class="kpi-value" id="kpi-2035">0</div>
                <div class="kpi-sub">NDC ëª©í‘œ ì‹œì  ê¸°ì¤€</div>
            </div>
            <div class="kpi-card" style="border-top-color: #f1c40f;">
                <div class="kpi-label">ì˜ˆìƒ í¬ë ˆë”§ ê°€ì¹˜ (KRW)</div>
                <div class="kpi-value" id="kpi-value">0</div>
                <div class="kpi-sub">â‚©15,000/í†¤ ê¸°ì¤€</div>
            </div>
            <div class="kpi-card" style="border-top-color: #e74c3c;">
                <div class="kpi-label">í‰ê·  COâ‚‚ í¡ìˆ˜ëŠ¥ (t/ha)</div>
                <div class="kpi-value" id="kpi-avg">0</div>
                <div class="kpi-sub">ë‹¨ìœ„ ë©´ì ë‹¹ íš¨ìœ¨ì„±</div>
            </div>
        </div>

        <div class="ndc-container">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h3 style="margin:0; font-size:1.1rem;"><i class="fa-solid fa-flag"></i> 2035 êµ­ê°€ íƒ„ì†Œì¤‘ë¦½(NDC) ê¸°ì—¬ë„ ë¶„ì„</h3>
                    <p style="margin:5px 0 0; font-size:0.85rem; opacity:0.8;">Target LULUCF Sink: 40,000,000 tCOâ‚‚eq/yr</p>
                </div>
                <div style="text-align:right;">
                    <div id="ndc-contribution-percent" style="font-size:1.2rem; font-weight:bold;">0.0000%</div>
                    <div style="font-size:0.8rem; opacity:0.7;">of National Target</div>
                </div>
            </div>
            <div class="ndc-bar-bg">
                <div id="ndc-bar" class="ndc-bar-fill"></div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:20px; font-size:0.85rem;">
                <div><i class="fa-solid fa-tree"></i> ë™ê¸‰ ìˆ² í•„ìš” ë©´ì : <strong id="ndc-req-area">0 ha</strong></div>
                <div><i class="fa-solid fa-layer-group"></i> í•„ìš” í”„ë¡œì íŠ¸ ìˆ˜: <strong id="ndc-req-count">0 ê°œ</strong></div>
                <div><i class="fa-solid fa-car"></i> ìŠ¹ìš©ì°¨ ìƒì‡„: <strong id="ndc-car">0 ëŒ€</strong></div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">
                <span><i class="fa-solid fa-chart-line"></i> ì—°ì°¨ë³„ í¡ìˆ˜ëŸ‰ ì‹œë®¬ë ˆì´ì…˜ (Cumulative)</span>
                <select style="width:150px;" id="chart-mode" onchange="updateChartType()">
                    <option value="cumulative">ëˆ„ì  í¡ìˆ˜ëŸ‰</option>
                    <option value="annual">ì—°ê°„ í¡ìˆ˜ëŸ‰</option>
                </select>
            </div>
            <div class="chart-wrapper">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">êµ¬íšë³„ ìƒì„¸ ë¶„ì„ (Analyst Report)</div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>êµ¬íš</th>
                        <th>ìˆ˜ì¢… (Species)</th>
                        <th>ì§€ìœ„ (Site Index)</th>
                        <th>ë©´ì  (ha)</th>
                        <th>ì´ í¡ìˆ˜ëŸ‰ (tCOâ‚‚)</th>
                        <th>íš¨ìœ¨ (tCOâ‚‚/ha)</th>
                        <th>ë¹„ê³ </th>
                    </tr>
                </thead>
                <tbody id="report-body">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
/**
 * ğŸŒ² FOREST MRV DATABASE v3.0
 * Source: AutomaticCalculator_Register_FM_v1.0.11._Form.xlsx
 * - [ì°¸ì¡°ì¸ì] ì‹œíŠ¸: WD(ëª©ì¬ê¸°ë³¸ë°€ë„), BEF(ë°”ì´ì˜¤ë§¤ìŠ¤í™•ì¥ê³„ìˆ˜), R(ë¿Œë¦¬í•¨ëŸ‰ë¹„), CF(íƒ„ì†Œì „í™˜ê³„ìˆ˜)
 * - [í˜„ì‹¤ë¦¼] ì‹œíŠ¸: ì„ë¶„ìˆ˜í™•í‘œ ì¬ì (m3) ëª¨ë¸ë§
 */
const FOREST_DB = {
    // 1. íƒ„ì†Œ í¡ìˆ˜ ê³„ìˆ˜ (Reference Factors)
    factors: {
        'pine_gw': { name: 'ê°•ì›ì§€ë°©ì†Œë‚˜ë¬´', WD: 0.42, BEF: 1.48, R: 0.26, CF: 0.51, color: '#145A32' },
        'pine_cb': { name: 'ì¤‘ë¶€ì§€ë°©ì†Œë‚˜ë¬´', WD: 0.47, BEF: 1.41, R: 0.25, CF: 0.51, color: '#27AE60' },
        'larch':   { name: 'ë‚™ì—½ì†¡',         WD: 0.45, BEF: 1.34, R: 0.29, CF: 0.51, color: '#D35400' },
        'cypress': { name: 'í¸ë°±',           WD: 0.43, BEF: 1.35, R: 0.20, CF: 0.51, color: '#16A085' },
        'tulip':   { name: 'ë°±í•©ë‚˜ë¬´',       WD: 0.46, BEF: 1.24, R: 0.23, CF: 0.48, color: '#F39C12' },
        'oak':     { name: 'ì‹ ê°ˆë‚˜ë¬´',       WD: 0.66, BEF: 1.60, R: 0.39, CF: 0.48, color: '#795548' }
    },

    // 2. ì„ë¶„ìˆ˜í™•í‘œ ì¬ì  ëª¨ë¸ (Volume Yield m3/ha)
    // - í˜„ì‹¤ë¦¼(2023) ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ Sìí˜•(Sigmoid) ê·¼ì‚¬ì¹˜
    // - Age 10, 20, 30, 40, 50, 60
    yields: {
        'pine_gw': [24, 85, 145, 195, 235, 265], 
        'pine_cb': [16, 68, 125, 172, 208, 235],
        'larch':   [20, 81, 140, 185, 220, 245],
        'cypress': [12, 55, 105, 150, 190, 225],
        'tulip':   [25, 98, 185, 260, 315, 350], // ì†ì„±ìˆ˜
        'oak':     [15, 48, 88, 128, 162, 190]
    },

    // 3. ì§€ìœ„ì§€ìˆ˜ ë³´ì • ê³„ìˆ˜ (Site Index Modifier)
    // 'ìƒ(Good)': 120%, 'ì¤‘(Avg)': 100%, 'í•˜(Poor)': 80% ê°€ì •
    siteModifiers: {
        'high': 1.2,
        'mid': 1.0,
        'low': 0.8
    }
};

let plots = [];
let chartInstance = null;
let currentChartData = null; // Store calculated data for mode switching

// ì´ˆê¸°í™”
window.onload = function() {
    addPlot('pine_cb', 10, 'mid'); // Default: ì¤‘ë¶€ì†Œë‚˜ë¬´ 10ha, ì§€ìœ„ 'ì¤‘'
    calculateMRV();
};

// [Logic] êµ¬íš ì¶”ê°€
function addPlot(defType='pine_cb', defArea=10, defSite='mid') {
    const id = Date.now();
    const container = document.getElementById('plot-container');
    
    // Select Options Generation
    let typeOptions = '';
    for(let k in FOREST_DB.factors) {
        typeOptions += `<option value="${k}" ${k===defType?'selected':''}>${FOREST_DB.factors[k].name}</option>`;
    }

    const html = `
    <div class="control-group" id="plot-${id}">
        <div class="control-header">
            <label>ğŸŒ² Plot #${plots.length+1}</label>
            <button class="btn-mini" onclick="removePlot(${id})"><i class="fa-solid fa-trash"></i> ì‚­ì œ</button>
        </div>
        <div class="input-row">
            <div>
                <small>ìˆ˜ì¢… (Species)</small>
                <select class="p-type">${typeOptions}</select>
            </div>
            <div>
                <small>ì§€ìœ„ (Site Index)</small>
                <select class="p-site">
                    <option value="high" ${defSite==='high'?'selected':''}>ìƒ (Good)</option>
                    <option value="mid" ${defSite==='mid'?'selected':''}>ì¤‘ (Avg)</option>
                    <option value="low" ${defSite==='low'?'selected':''}>í•˜ (Poor)</option>
                </select>
            </div>
        </div>
        <div class="input-row">
            <div>
                <small>ë©´ì  (Area, ha)</small>
                <input type="number" class="p-area" value="${defArea}" step="0.1">
            </div>
            <div>
                <small>ì‹ì¬ë°€ë„ (Trees/ha)</small>
                <input type="number" class="p-density" value="3000" step="100">
            </div>
        </div>
    </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
    plots.push(id);
}

function removePlot(id) {
    document.getElementById(`plot-${id}`).remove();
    plots = plots.filter(p => p !== id);
}

// [Core Logic] Cubic Spline Interpolation for Growth
function getVolume(species, site, year) {
    const rawData = FOREST_DB.yields[species];
    const modifier = FOREST_DB.siteModifiers[site];
    
    // ë‹¨ìˆœ ì„ í˜• ë³´ê°„ (Linear Interpolation for robustness)
    let vol = 0;
    if (year < 10) {
        vol = (rawData[0] / 10) * year;
    } else {
        let idx = Math.floor(year / 10) - 1;
        if (idx >= rawData.length - 1) {
            vol = rawData[rawData.length - 1]; // Max limit
        } else {
            let v1 = rawData[idx];
            let v2 = rawData[idx + 1];
            vol = v1 + (v2 - v1) * ((year % 10) / 10);
        }
    }
    return vol * modifier;
}

// [Calculation] MRV Analysis
function calculateMRV() {
    const simYears = parseInt(document.getElementById('sim-years').value);
    const plotDivs = document.querySelectorAll('.control-group');
    
    let totalCumulative = new Array(simYears).fill(0);
    let totalAnnual = new Array(simYears).fill(0);
    let plotResults = [];
    let datasets = [];

    // Global Aggregate
    let totalArea = 0;
    let grandTotalCarbon = 0;

    plotDivs.forEach((div, idx) => {
        const type = div.querySelector('.p-type').value;
        const site = div.querySelector('.p-site').value;
        const area = parseFloat(div.querySelector('.p-area').value);
        // const density = parseInt(div.querySelector('.p-density').value); // Yield table assumes standard density, used for reference only

        const factor = FOREST_DB.factors[type];
        let yearlyCarbon = [];
        let cumData = [];
        
        let lastVol = 0;
        let lastCarbon = 0;

        for (let y = 1; y <= simYears; y++) {
            // 1. ì„ë¶„ì¬ì  (m3/ha)
            const volPerHa = getVolume(type, site, y);
            
            // 2. ë°”ì´ì˜¤ë§¤ìŠ¤ ì‚°ì • (Biomass = Vol * WD * BEF)
            const biomass = volPerHa * factor.WD * factor.BEF;
            
            // 3. íƒ„ì†Œì¬ì  ì‚°ì • (Carbon = Biomass * (1+R) * CF * 44/12)
            const carbonPerHa = biomass * (1 + factor.R) * factor.CF * (44/12);
            
            const totalC = carbonPerHa * area; // Total for this plot

            cumData.push(totalC);
            totalCumulative[y-1] += totalC;

            // Annual Flux
            const annualFlux = totalC - lastCarbon;
            yearlyCarbon.push(annualFlux);
            totalAnnual[y-1] += annualFlux;

            lastCarbon = totalC;
        }

        grandTotalCarbon += lastCarbon;
        totalArea += area;

        plotResults.push({
            id: idx + 1,
            name: factor.name,
            site: site,
            area: area,
            total: lastCarbon,
            efficiency: lastCarbon / area
        });

        datasets.push({
            label: `Plot ${idx+1}: ${factor.name}`,
            data: cumData, // Default to cumulative
            data_annual: yearlyCarbon,
            borderColor: factor.color,
            backgroundColor: 'transparent',
            borderWidth: 1,
            borderDash: [5, 5]
        });
    });

    // Add Total Dataset
    datasets.unshift({
        label: 'Total (Project)',
        data: totalCumulative,
        data_annual: totalAnnual,
        borderColor: '#2C3E50',
        backgroundColor: 'rgba(44, 62, 80, 0.1)',
        borderWidth: 3,
        fill: true,
        tension: 0.4
    });

    currentChartData = { labels: Array.from({length:simYears}, (_,i)=>2026+i), datasets: datasets };
    
    // Render
    updateKPIs(totalCumulative, totalAnnual, totalArea);
    updateChartType(); // Draws chart based on selection
    renderTable(plotResults);
}

function updateKPIs(cumulative, annual, area) {
    const finalCum = cumulative[cumulative.length-1];
    
    // 2035ë…„ (10ë…„ì°¨)
    let idx2035 = 9; // 2026 is year 0 in array? No, loop started 1 -> 2026 is idx 0
    // Simulation starts 2026 (Year 1). 2035 is Year 10. Index 9.
    const annual2035 = annual[9] || 0;

    // 1. Total KPI
    animateValue("kpi-total", finalCum, 0);
    animateValue("kpi-2035", annual2035, 1);
    animateValue("kpi-value", finalCum * 15000, 0, true);
    animateValue("kpi-avg", finalCum / area, 1);

    // 2. NDC Logic
    const targetNDC = 40000000; // 40 MtCO2
    const contribution = (annual2035 / targetNDC) * 100;
    
    document.getElementById('ndc-contribution-percent').innerText = contribution.toFixed(6) + "%";
    document.getElementById('ndc-bar').style.width = Math.min(contribution * 5000, 100) + "%"; // Visual scale up

    // ì—­ì‚° (Reverse Calculation)
    const factor = targetNDC / annual2035;
    document.getElementById('ndc-req-area').innerText = (area * factor).toLocaleString(undefined, {maximumFractionDigits:0}) + " ha";
    document.getElementById('ndc-req-count').innerText = Math.ceil(factor).toLocaleString();
    document.getElementById('ndc-car').innerText = (annual2035 / 2.4).toLocaleString(undefined, {maximumFractionDigits:0});
}

function updateChartType() {
    const mode = document.getElementById('chart-mode').value;
    const ctx = document.getElementById('mainChart').getContext('2d');
    
    // Switch Data
    let viewDatasets = currentChartData.datasets.map(ds => ({
        ...ds,
        data: mode === 'cumulative' ? ds.data : ds.data_annual,
        fill: (mode === 'cumulative' && ds.label.includes('Total')) ? true : false
    }));

    if(chartInstance) chartInstance.destroy();

    chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: currentChartData.labels,
            datasets: viewDatasets
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ': ' + context.parsed.y.toLocaleString(undefined, {maximumFractionDigits: 1}) + ' tCOâ‚‚';
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: mode==='cumulative' ? 'Cumulative tCOâ‚‚' : 'Annual tCOâ‚‚/yr' }
                }
            }
        }
    });
}

function renderTable(data) {
    const tbody = document.getElementById('report-body');
    tbody.innerHTML = '';
    data.forEach(d => {
        let note = "-";
        if(d.name.includes('ë°±í•©')) note = "ì†ì„±ìˆ˜(Fast Growing)";
        if(d.name.includes('ì†Œë‚˜ë¬´') && d.site === 'high') note = "ìµœì ì§€ ìƒìœ¡";
        
        const row = `
        <tr>
            <td>Plot #${d.id}</td>
            <td style="font-weight:bold; color:${FOREST_DB.factors[Object.keys(FOREST_DB.factors).find(key => FOREST_DB.factors[key].name === d.name)].color}">
                ${d.name}
            </td>
            <td>${d.site === 'high' ? 'ìƒ' : (d.site === 'mid' ? 'ì¤‘' : 'í•˜')}</td>
            <td>${d.area}</td>
            <td>${d.total.toLocaleString(undefined, {maximumFractionDigits:1})}</td>
            <td>${d.efficiency.toFixed(1)}</td>
            <td style="font-size:0.8rem; color:#888;">${note}</td>
        </tr>
        `;
        tbody.insertAdjacentHTML('beforeend', row);
    });
}

function animateValue(id, value, decimals, isMoney=false) {
    const el = document.getElementById(id);
    let str = value.toLocaleString(undefined, {maximumFractionDigits: decimals});
    if(isMoney) str = "â‚©" + str;
    el.innerText = str;
    // Simple visual flash
    el.style.color = "#27ae60";
    setTimeout(() => el.style.color = "var(--text)", 500);
}

</script>
</body>
</html>
