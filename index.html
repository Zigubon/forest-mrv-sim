<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚°ë¦¼íƒ„ì†Œìƒì‡„ MRV ì‹œë®¬ë ˆì´í„° Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 1. Wide Layout & Design */
        :root { --primary: #27ae60; --dark: #2c3e50; --light: #f8f9fa; }
        body { margin: 0; padding: 0; font-family: 'Pretendard', 'Noto Sans KR', sans-serif; background: #e9ecef; color: #333; }
        
        .container { max-width: 1400px; margin: 30px auto; padding: 20px; display: grid; grid-template-columns: 300px 1fr; gap: 20px; }
        
        /* ì™¼ìª½ ì‚¬ì´ë“œë°” (ì»¨íŠ¸ë¡¤ íŒ¨ë„) */
        .sidebar { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); height: fit-content; }
        .logo { font-size: 1.4rem; font-weight: bold; color: var(--dark); margin-bottom: 25px; border-bottom: 2px solid var(--primary); padding-bottom: 10px; display: block; }
        
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; color: #555; }
        .input-group select, .input-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; box-sizing: border-box; }
        
        .btn-run { width: 100%; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        .btn-run:hover { background: #219150; transform: translateY(-2px); }

        /* ì˜¤ë¥¸ìª½ ë©”ì¸ ì»¨í…ì¸  */
        .main-content { display: flex; flex-direction: column; gap: 20px; }
        
        /* ìƒë‹¨ ì¹´ë“œ (ìš”ì•½ ì •ë³´) */
        .summary-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); display: flex; align-items: center; gap: 15px; }
        .card-icon { width: 50px; height: 50px; background: #e8f6f3; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: var(--primary); }
        .card-info h4 { margin: 0; font-size: 0.85rem; color: #888; }
        .card-info p { margin: 5px 0 0; font-size: 1.2rem; font-weight: bold; color: var(--dark); }

        /* ì°¨íŠ¸ ì˜ì—­ */
        .chart-container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); min-height: 400px; }
        
        /* í•˜ë‹¨ ë¶„ì„ ë…¸íŠ¸ & ë¹„êµ */
        .bottom-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .analyst-note, .impact-box { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .note-header { font-weight: bold; color: var(--dark); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        
        .impact-list { list-style: none; padding: 0; margin: 0; }
        .impact-item { display: flex; align-items: center; gap: 15px; padding: 10px 0; border-bottom: 1px solid #eee; }
        .impact-item:last-child { border-bottom: none; }
        .impact-icon { font-size: 1.2rem; width: 30px; text-align: center; }

        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } .summary-cards { grid-template-columns: 1fr; } .bottom-section { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="sidebar">
        <span class="logo">ğŸŒ² Forest MRV Sim</span>
        
        <div class="input-group">
            <label>ğŸŒ± ìˆ˜ì¢… (Species)</label>
            <select id="sim-species">
                <option value="pine">ì†Œë‚˜ë¬´ (ì „í†µì  ì¡°ë¦¼)</option>
                <option value="tulip">ë°±í•©ë‚˜ë¬´ (ì†ì„±ìˆ˜/ê²½ì œìˆ˜)</option>
                <option value="larch">ë‚™ì—½ì†¡ (Larch)</option>
                <option value="nutpine">ì£ë‚˜ë¬´ (Nut Pine)</option>
                <option value="cypress">í¸ë°± (Cypress)</option>
                <option value="evergreen">ìƒë¡í™œì—½ìˆ˜ (ê¸°í›„ì ì‘í˜•)</option>
            </select>
        </div>

        <div class="input-group">
            <label>ğŸ”¢ ì‹ì¬ ë³¸ìˆ˜ (Trees)</label>
            <input type="number" id="sim-count" value="1000" step="100">
        </div>

        <div class="input-group">
            <label>â±ï¸ ì‹œë®¬ë ˆì´ì…˜ ê¸°ê°„ (Years)</label>
            <input type="number" id="sim-years" value="40" max="60" min="10">
        </div>

        <button class="btn-run" onclick="runSimulation()">ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>
        
        <div style="margin-top: 20px; font-size: 0.8rem; color: #999; line-height: 1.4;">
            * ë°ì´í„° ì¶œì²˜:<br>êµ­ë¦½ì‚°ë¦¼ê³¼í•™ì› í‘œì¤€ íƒ„ì†Œí¡ìˆ˜ëŸ‰(2023)<br>êµ­ê°€ ì˜¨ì‹¤ê°€ìŠ¤ ì¸ë²¤í† ë¦¬ ê³„ìˆ˜ ì ìš©
        </div>
    </div>

    <div class="main-content">
        <div class="summary-cards">
            <div class="card">
                <div class="card-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div>
                <div class="card-info">
                    <h4>ì´ ëˆ„ì  í¡ìˆ˜ëŸ‰</h4>
                    <p id="res-total">0 tCOâ‚‚</p>
                </div>
            </div>
            <div class="card">
                <div class="card-icon"><i class="fa-solid fa-tree"></i></div>
                <div class="card-info">
                    <h4>ì—°í‰ê·  í¡ìˆ˜ëŸ‰</h4>
                    <p id="res-annual">0 tCOâ‚‚/yr</p>
                </div>
            </div>
            <div class="card">
                <div class="card-icon"><i class="fa-solid fa-won-sign"></i></div>
                <div class="card-info">
                    <h4>ì˜ˆìƒ íƒ„ì†Œë°°ì¶œê¶Œ ê°€ì¹˜</h4>
                    <p id="res-value">â‚©0</p>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="carbonChart"></canvas>
        </div>

        <div class="bottom-section">
            <div class="analyst-note">
                <div class="note-header"><i class="fa-solid fa-pen-nib"></i> Analyst Note</div>
                <p id="note-content" style="font-size: 0.95rem; line-height: 1.6; color: #555;">
                    ì‹œë®¬ë ˆì´ì…˜ì„ ì‹¤í–‰í•˜ë©´ ìˆ˜ì¢…ë³„ ìƒì¥ íŠ¹ì„±ê³¼ íƒ„ì†Œ í¡ìˆ˜ íŒ¨í„´ì— ëŒ€í•œ ì „ë¬¸ ë¶„ì„ ì½”ë©˜íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                </p>
            </div>

            <div class="impact-box">
                <div class="note-header"><i class="fa-solid fa-scale-balanced"></i> Environmental Impact</div>
                <ul class="impact-list">
                    <li class="impact-item">
                        <div class="impact-icon">ğŸš—</div>
                        <div>ìŠ¹ìš©ì°¨ <strong id="imp-car">0</strong>ëŒ€ì˜ ì—°ê°„ ë°°ì¶œëŸ‰ ìƒì‡„</div>
                    </li>
                    <li class="impact-item">
                        <div class="impact-icon">âœˆï¸</div>
                        <div>ì¸ì²œ-ë‰´ìš• í¸ë„ <strong id="imp-flight">0</strong>íšŒ ë¹„í–‰ ë°°ì¶œëŸ‰ ìƒì‡„</div>
                    </li>
                    <li class="impact-item">
                        <div class="impact-icon">â˜•</div>
                        <div>ì•„ë©”ë¦¬ì¹´ë…¸ <strong id="imp-coffee">0</strong>ì” ìƒì‚° ë°°ì¶œëŸ‰ ìƒì‡„</div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
/**
 * ğŸŒ² FOREST MRV DATASET (2023 NIFOS Standard) - Patched Version
 * - ìˆ˜ì •ë‚´ì—­: í¸ë°±ë‚˜ë¬´ í‚¤ê°’ ë§¤ì¹­ ì˜¤ë¥˜ ìˆ˜ì • (pitch -> cypress)
 */
const FOREST_DB = {
    // 1. íƒ„ì†Œ ë°°ì¶œ/í¡ìˆ˜ ê³„ìˆ˜ (WD, BEF, R, CF)
    factors: {
        'pine': { name: 'ì†Œë‚˜ë¬´(ì¤‘ë¶€)', WD: 0.47, BEF: 1.41, R: 0.25, CF: 0.51 },
        'gangwon_pine': { name: 'ì†Œë‚˜ë¬´(ê°•ì›)', WD: 0.42, BEF: 1.48, R: 0.26, CF: 0.51 },
        'rigida': { name: 'ë¦¬ê¸°ë‹¤ì†Œë‚˜ë¬´', WD: 0.50, BEF: 1.33, R: 0.36, CF: 0.51 },
        'larch': { name: 'ë‚™ì—½ì†¡', WD: 0.45, BEF: 1.34, R: 0.29, CF: 0.51 },
        'nutpine': { name: 'ì£ë‚˜ë¬´', WD: 0.41, BEF: 1.74, R: 0.28, CF: 0.51 },
        'cypress': { name: 'í¸ë°±', WD: 0.43, BEF: 1.35, R: 0.20, CF: 0.51 }, // í‚¤ê°’ ìˆ˜ì •ë¨!
        'cedar': { name: 'ì‚¼ë‚˜ë¬´', WD: 0.35, BEF: 1.31, R: 0.23, CF: 0.51 },
        'oak_s': { name: 'ì‹ ê°ˆë‚˜ë¬´', WD: 0.66, BEF: 1.60, R: 0.39, CF: 0.48 }, 
        'oak_g': { name: 'êµ´ì°¸ë‚˜ë¬´', WD: 0.72, BEF: 1.34, R: 0.32, CF: 0.48 },
        'tulip': { name: 'ë°±í•©ë‚˜ë¬´', WD: 0.46, BEF: 1.24, R: 0.23, CF: 0.48 },
        'evergreen': { name: 'ìƒë¡í™œì—½ìˆ˜(ê°€ì‹œë‚˜ë¬´)', WD: 0.70, BEF: 2.29, R: 0.30, CF: 0.48 }
    },
    
    // 2. ì„ë¶„ìˆ˜í™•í‘œ (ì—°ë ¹ë³„ haë‹¹ ì¬ì  m3)
    yields: {
        'pine': [16.5, 68.2, 125.4, 172.5, 208.3, 235.1, 255.4, 270.2],
        'gangwon_pine': [24.5, 85.2, 145.4, 195.5, 235.3, 265.1, 285.4, 300.2],
        'rigida': [18.2, 75.5, 130.4, 165.5, 185.3, 195.1, 200.4, 202.2],
        'larch': [19.8, 81.5, 140.2, 185.5, 220.4, 245.0, 265.5, 280.0],
        'nutpine': [15.0, 60.5, 115.2, 160.5, 195.0, 220.0, 240.5, 255.0],
        'cypress': [12.5, 55.2, 105.4, 150.2, 190.5, 225.1, 250.5, 270.0], // í‚¤ê°’ ìˆ˜ì •ë¨!
        'cedar': [18.5, 75.2, 135.4, 180.2, 215.5, 240.1, 260.5, 275.0],
        'oak_s': [15.2, 48.5, 88.7, 128.4, 162.8, 190.5, 215.4, 235.2],
        'oak_g': [16.5, 52.5, 95.7, 135.4, 170.8, 200.5, 225.4, 245.2],
        'tulip': [25.4, 98.5, 185.2, 260.5, 315.0, 350.2, 380.5, 400.0],
        'evergreen': [18.0, 55.2, 102.5, 145.0, 185.5, 210.0, 230.5, 250.0]
    }
};

let myChart = null;

// [Core Logic] ì„ í˜• ë³´ê°„ í•¨ìˆ˜
function getInterpolatedVolume(speciesYield, year) {
    if (year < 10) return (speciesYield[0] / 10) * year;

    let idx = Math.floor(year / 10) - 1;
    if (idx >= speciesYield.length - 1) return speciesYield[speciesYield.length - 1];

    let y1 = speciesYield[idx];
    let y2 = speciesYield[idx + 1];
    let fraction = (year % 10) / 10;

    return y1 + (y2 - y1) * fraction;
}

// [Core Logic] ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ í•¨ìˆ˜
function runSimulation() {
    try {
        const species = document.getElementById('sim-species').value;
        const count = parseInt(document.getElementById('sim-count').value);
        const years = parseInt(document.getElementById('sim-years').value);

        const factor = FOREST_DB.factors[species];
        let yieldData = FOREST_DB.yields[species];

        if (!yieldData) {
            console.warn(`[Warning] No yield data for ${species}. Using Oak model.`);
            yieldData = FOREST_DB.yields['oak_s'];
        }

        let labels = [];
        let data = [];
        
        for (let yr = 1; yr <= years; yr++) {
            let volPerHa = getInterpolatedVolume(yieldData, yr);
            let volPerTree = volPerHa / 1200;
            let totalCarbon = (volPerTree * count) * factor.WD * factor.BEF * (1 + factor.R) * factor.CF * (44/12);

            labels.push(2026 + yr);
            data.push(totalCarbon.toFixed(2));
        }

        // ê²°ê³¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const finalVal = parseFloat(data[data.length - 1]);
        const annualVal = finalVal / years;

        document.getElementById('res-total').innerText = finalVal.toLocaleString(undefined, {maximumFractionDigits: 1}) + " tCOâ‚‚";
        document.getElementById('res-annual').innerText = annualVal.toFixed(2) + " tCOâ‚‚/yr";
        document.getElementById('res-value').innerText = "â‚©" + Math.floor(finalVal * 15000).toLocaleString();

        document.getElementById('imp-car').innerText = (finalVal / 2.4).toLocaleString(undefined, {maximumFractionDigits: 1});
        document.getElementById('imp-flight').innerText = (finalVal / 1.2).toLocaleString(undefined, {maximumFractionDigits: 1});
        document.getElementById('imp-coffee').innerText = Math.floor(finalVal / 0.000021).toLocaleString();

        // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        const ctx = document.getElementById('carbonChart');
        if (myChart) myChart.destroy();

        // ìˆ˜ì¢…ë³„ ìƒ‰ìƒ (í¸ë°± ì¶”ê°€)
        let chartColor = '#27ae60'; // ê¸°ë³¸ ì´ˆë¡
        if (species === 'tulip') chartColor = '#e67e22'; // ë°±í•©-ì£¼í™©
        if (species === 'evergreen') chartColor = '#2980b9'; // ìƒë¡-íŒŒë‘
        if (species === 'cypress') chartColor = '#16a085'; // í¸ë°±-ì²­ë¡ìƒ‰ (New!)

        myChart = new Chart(ctx.getContext('2d'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: `ëˆ„ì  íƒ„ì†Œ í¡ìˆ˜ëŸ‰ (${factor.name})`,
                    data: data,
                    borderColor: chartColor,
                    backgroundColor: chartColor + '20',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(ctx) { return ` ${ctx.parsed.y} tCOâ‚‚`; }
                        }
                    }
                },
                scales: {
                    x: { grid: { display: false } },
                    y: { 
                        beginAtZero: true, 
                        grid: { borderDash: [5, 5] },
                        title: { display: true, text: 'tCOâ‚‚ (Total)' }
                    }
                }
            }
        });

        // Analyst Note ì—…ë°ì´íŠ¸
        updateNote(species);

    } catch (err) {
        console.error("Simulation Error:", err);
        alert("ê·¸ë˜í”„ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
}

function updateNote(species) {
    const noteEl = document.getElementById('note-content');
    let msg = "";
    if (species === 'tulip') {
        msg = "<strong>[ë°±í•©ë‚˜ë¬´]</strong>ëŠ” ì´ˆê¸° ì„±ì¥ ì†ë„ê°€ ë§¤ìš° ë¹¨ë¼ 'íƒ„ì†Œ í¡ìˆ˜ í•˜ë§ˆ'ë¡œ ë¶ˆë¦½ë‹ˆë‹¤. ê²½ì œë¦¼ ì¡°ì„±ê³¼ íƒ„ì†Œë°°ì¶œê¶Œ í™•ë³´ë¥¼ ë™ì‹œì— ë…¸ë¦¬ëŠ” ê¸°ì—… ESG í”„ë¡œì íŠ¸ì— ì í•©í•©ë‹ˆë‹¤.";
    } else if (species === 'evergreen') {
        msg = "<strong>[ìƒë¡í™œì—½ìˆ˜]</strong>ëŠ” ë‚œëŒ€ ìˆ˜ì¢…ìœ¼ë¡œ, ê¸°í›„ë³€í™”ë¡œ ì¸í•œ ì‹ìƒëŒ€ ë¶ìƒì— ëŒ€ë¹„í•˜ëŠ” 'ì ì‘í˜•(Adaptation)' ìˆ˜ì¢…ì…ë‹ˆë‹¤. ëª©ì¬ ë°€ë„ê°€ ë†’ì•„ ì¥ê¸°ì ì¸ íƒ„ì†Œ ì €ì¥ ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.";
    } else if (species === 'cypress') {
        msg = "<strong>[í¸ë°±ë‚˜ë¬´]</strong>ëŠ” í”¼í†¤ì¹˜ë“œ ë°œìƒëŸ‰ì´ ë§ì•„ 'ì¹˜ìœ ì˜ ìˆ²' ì¡°ì„±ì— ê°€ì¥ ì¸ê¸° ìˆëŠ” ìˆ˜ì¢…ì…ë‹ˆë‹¤. ì´ˆê¸° ìƒì¥ì€ ë‹¤ì†Œ ëŠë¦¬ì§€ë§Œ, 30ë…„ ì´í›„ì—ë„ ê¾¸ì¤€í•œ íƒ„ì†Œ í¡ìˆ˜ëŸ‰ì„ ë³´ì´ë©° ëª©ì¬ ê°€ì¹˜ê°€ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.";
    } else if (species === 'pine') {
        msg = "<strong>[ì†Œë‚˜ë¬´]</strong>ëŠ” í•œêµ­ì˜ ëŒ€í‘œ ìˆ˜ì¢…ì´ë‚˜, ê¸°í›„ë³€í™”ì™€ ë³‘í•´ì¶©ì— ì·¨ì•½í•´ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë‹¨ì¼ ìˆ˜ì¢… ì‹ì¬ë³´ë‹¤ëŠ” í™œì—½ìˆ˜ì™€ì˜ í˜¼íš¨ë¦¼ ì¡°ì„±ì´ ê¶Œì¥ë©ë‹ˆë‹¤.";
    } else {
        msg = "ì„ íƒí•˜ì‹  ìˆ˜ì¢…ì€ êµ­ë¦½ì‚°ë¦¼ê³¼í•™ì›ì˜ í‘œì¤€ ìƒì¥ ëª¨ë¸ì„ ë”°ë¦…ë‹ˆë‹¤. 40ë…„ ì´í›„ í¡ìˆ˜ëŸ‰ì´ ë‘”í™”ë˜ë¯€ë¡œ, ì ì ˆí•œ ê°„ë²Œ(ì†ì•„ë² ê¸°)ê³¼ ìˆ˜ì¢… ê°±ì‹  ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.";
    }
    noteEl.innerHTML = msg;
}

window.onload = runSimulation;
</script>

</body>
</html>
