<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚°ë¦¼íƒ„ì†Œìƒì‡„ MRV ì‹œë®¬ë ˆì´í„° Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 1. Wide Layout & Design */
        :root { --primary: #27ae60; --dark: #2c3e50; --light: #f8f9fa; }
        body { margin: 0; padding: 0; font-family: 'Pretendard', 'Noto Sans KR', sans-serif; background: #e9ecef; color: #333; }
        
        .container { max-width: 1400px; margin: 30px auto; padding: 20px; display: grid; grid-template-columns: 300px 1fr; gap: 20px; }
        
        /* ì™¼ìª½ ì‚¬ì´ë“œë°” (ì»¨íŠ¸ë¡¤ íŒ¨ë„) */
        .sidebar { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); height: fit-content; }
        .logo { font-size: 1.4rem; font-weight: bold; color: var(--dark); margin-bottom: 25px; border-bottom: 2px solid var(--primary); padding-bottom: 10px; display: block; }
        
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; color: #555; }
        .input-group select, .input-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; box-sizing: border-box; }
        
        .btn-run { width: 100%; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        .btn-run:hover { background: #219150; transform: translateY(-2px); }

        /* ì˜¤ë¥¸ìª½ ë©”ì¸ ì»¨í…ì¸  */
        .main-content { display: flex; flex-direction: column; gap: 20px; }
        
        /* ìƒë‹¨ ì¹´ë“œ (ìš”ì•½ ì •ë³´) */
        .summary-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); display: flex; align-items: center; gap: 15px; }
        .card-icon { width: 50px; height: 50px; background: #e8f6f3; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: var(--primary); }
        .card-info h4 { margin: 0; font-size: 0.85rem; color: #888; }
        .card-info p { margin: 5px 0 0; font-size: 1.2rem; font-weight: bold; color: var(--dark); }

        /* ì°¨íŠ¸ ì˜ì—­ */
        .chart-container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); min-height: 400px; }
        
        /* í•˜ë‹¨ ë¶„ì„ ë…¸íŠ¸ & ë¹„êµ */
        .bottom-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .analyst-note, .impact-box { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .note-header { font-weight: bold; color: var(--dark); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        
        .impact-list { list-style: none; padding: 0; margin: 0; }
        .impact-item { display: flex; align-items: center; gap: 15px; padding: 10px 0; border-bottom: 1px solid #eee; }
        .impact-item:last-child { border-bottom: none; }
        .impact-icon { font-size: 1.2rem; width: 30px; text-align: center; }

        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } .summary-cards { grid-template-columns: 1fr; } .bottom-section { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="sidebar">
        <span class="logo">ğŸŒ² Forest MRV Sim</span>
        
        <div class="input-group">
            <label>ğŸŒ± ìˆ˜ì¢… (Species)</label>
            <select id="sim-species">
                <option value="pine">ì†Œë‚˜ë¬´ (ì „í†µì  ì¡°ë¦¼)</option>
                <option value="tulip">ë°±í•©ë‚˜ë¬´ (ì†ì„±ìˆ˜/ê²½ì œìˆ˜)</option>
                <option value="larch">ë‚™ì—½ì†¡ (Larch)</option>
                <option value="nutpine">ì£ë‚˜ë¬´ (Nut Pine)</option>
                <option value="cypress">í¸ë°± (Cypress)</option>
                <option value="evergreen">ìƒë¡í™œì—½ìˆ˜ (ê¸°í›„ì ì‘í˜•)</option>
            </select>
        </div>

        <div class="input-group">
            <label>ğŸ”¢ ì‹ì¬ ë³¸ìˆ˜ (Trees)</label>
            <input type="number" id="sim-count" value="1000" step="100">
        </div>

        <div class="input-group">
            <label>â±ï¸ ì‹œë®¬ë ˆì´ì…˜ ê¸°ê°„ (Years)</label>
            <input type="number" id="sim-years" value="40" max="60" min="10">
        </div>

        <button class="btn-run" onclick="runSimulation()">ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>
        
        <div style="margin-top: 20px; font-size: 0.8rem; color: #999; line-height: 1.4;">
            * ë°ì´í„° ì¶œì²˜:<br>êµ­ë¦½ì‚°ë¦¼ê³¼í•™ì› í‘œì¤€ íƒ„ì†Œí¡ìˆ˜ëŸ‰(2023)<br>êµ­ê°€ ì˜¨ì‹¤ê°€ìŠ¤ ì¸ë²¤í† ë¦¬ ê³„ìˆ˜ ì ìš©
        </div>
    </div>

    <div class="main-content">
        <div class="summary-cards">
            <div class="card">
                <div class="card-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div>
                <div class="card-info">
                    <h4>ì´ ëˆ„ì  í¡ìˆ˜ëŸ‰</h4>
                    <p id="res-total">0 tCOâ‚‚</p>
                </div>
            </div>
            <div class="card">
                <div class="card-icon"><i class="fa-solid fa-tree"></i></div>
                <div class="card-info">
                    <h4>ì—°í‰ê·  í¡ìˆ˜ëŸ‰</h4>
                    <p id="res-annual">0 tCOâ‚‚/yr</p>
                </div>
            </div>
            <div class="card">
                <div class="card-icon"><i class="fa-solid fa-won-sign"></i></div>
                <div class="card-info">
                    <h4>ì˜ˆìƒ íƒ„ì†Œë°°ì¶œê¶Œ ê°€ì¹˜</h4>
                    <p id="res-value">â‚©0</p>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="carbonChart"></canvas>
        </div>

        <div class="bottom-section">
            <div class="analyst-note">
                <div class="note-header"><i class="fa-solid fa-pen-nib"></i> Analyst Note</div>
                <p id="note-content" style="font-size: 0.95rem; line-height: 1.6; color: #555;">
                    ì‹œë®¬ë ˆì´ì…˜ì„ ì‹¤í–‰í•˜ë©´ ìˆ˜ì¢…ë³„ ìƒì¥ íŠ¹ì„±ê³¼ íƒ„ì†Œ í¡ìˆ˜ íŒ¨í„´ì— ëŒ€í•œ ì „ë¬¸ ë¶„ì„ ì½”ë©˜íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                </p>
            </div>

            <div class="impact-box">
                <div class="note-header"><i class="fa-solid fa-scale-balanced"></i> Environmental Impact</div>
                <ul class="impact-list">
                    <li class="impact-item">
                        <div class="impact-icon">ğŸš—</div>
                        <div>ìŠ¹ìš©ì°¨ <strong id="imp-car">0</strong>ëŒ€ì˜ ì—°ê°„ ë°°ì¶œëŸ‰ ìƒì‡„</div>
                    </li>
                    <li class="impact-item">
                        <div class="impact-icon">âœˆï¸</div>
                        <div>ì¸ì²œ-ë‰´ìš• í¸ë„ <strong id="imp-flight">0</strong>íšŒ ë¹„í–‰ ë°°ì¶œëŸ‰ ìƒì‡„</div>
                    </li>
                    <li class="impact-item">
                        <div class="impact-icon">â˜•</div>
                        <div>ì•„ë©”ë¦¬ì¹´ë…¸ <strong id="imp-coffee">0</strong>ì” ìƒì‚° ë°°ì¶œëŸ‰ ìƒì‡„</div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
/**
 * [Data Layer] NIFOS 2023 Standard Factors
 * - Factors: ê³„ìˆ˜ (WD, BEF, R, CF)
 * - Yields: 10ë…„ ë‹¨ìœ„ haë‹¹ ì¬ì  (m3) -> 1,200ë³¸/ha ê¸°ì¤€ ì—­ì‚°
 */
const FOREST_DB = {
    factors: {
        'pine': { WD: 0.47, BEF: 1.41, R: 0.25, CF: 0.51 },
        'tulip': { WD: 0.43, BEF: 1.25, R: 0.26, CF: 0.48 },
        'larch': { WD: 0.45, BEF: 1.34, R: 0.29, CF 0.51 }, // ë‚™ì—½ì†¡
        'nutpine': { WD: 0.41, BEF: 1.74, R: 0.28, CF: 0.51 }, // ì£ë‚˜ë¬´
        'cypress': { WD: 0.43, BEF: 1.35, R: 0.20, CF: 0.51 }, // í¸ë°±
        'evergreen': { WD: 0.70, BEF: 2.29, R: 0.30, CF: 0.48 } // ìƒë¡í™œì—½ìˆ˜
    },
    yields: { // 10, 20, 30, 40, 50, 60ë…„ìƒ ê¸°ì¤€ (ì¶œì²˜: í˜„ì‹¤ë¦¼ ìˆ˜í™•í‘œ ì¬ê°€ê³µ)
        'pine': [16.5, 68.2, 125.4, 172.5, 208.3, 235.1],
        'tulip': [25.4, 98.5, 185.2, 260.5, 315.0, 350.2],
        'larch': [19.8, 81.5, 140.2, 185.5, 220.4, 245.0], // ë‚™ì—½ì†¡ (ì¶”ì •ì¹˜)
        'nutpine': [15.0, 60.5, 115.2, 160.5, 195.0, 220.0], // ì£ë‚˜ë¬´ (ì¶”ì •ì¹˜)
        'cypress': [12.5, 55.2, 105.4, 150.2, 190.5, 225.1], // í¸ë°± (ì´ˆê¸° ëŠë¦¼, í›„ê¸° ê¾¸ì¤€)
        'oak_model': [15.2, 48.5, 88.7, 128.4, 162.8, 190.5] // ì°¸ë‚˜ë¬´ë¥˜ ì„±ì¥ê³¡ì„ 
    }
};

let myChart = null;

// [Core Logic] 3. Smooth Curve (Linear Interpolation)
function getInterpolatedVolume(speciesYield, year) {
    if (year < 10) {
        // 0~10ë…„ êµ¬ê°„: 0ì—ì„œ 10ë…„ì¹˜ ë°ì´í„°ê¹Œì§€ ì„ í˜• ì¦ê°€
        return (speciesYield[0] / 10) * year;
    }
    
    // 10ë…„ ë‹¨ìœ„ ì¸ë±ìŠ¤ (0: 10ë…„, 1: 20ë…„ ...)
    let idx = Math.floor(year / 10) - 1; 
    if (idx >= speciesYield.length - 1) return speciesYield[speciesYield.length - 1]; // ìµœëŒ€ì¹˜ ë„ë‹¬

    let y1 = speciesYield[idx];
    let y2 = speciesYield[idx + 1];
    
    // êµ¬ê°„ ë‚´ì—ì„œì˜ ì§„í–‰ë¥  (0.0 ~ 0.9)
    let fraction = (year % 10) / 10;
    
    // ì„ í˜• ë³´ê°„: y = y1 + (y2 - y1) * fraction
    return y1 + (y2 - y1) * fraction;
}

function runSimulation() {
    const species = document.getElementById('sim-species').value;
    const count = parseInt(document.getElementById('sim-count').value);
    const years = parseInt(document.getElementById('sim-years').value);
    
    const factor = FOREST_DB.factors[species];
    let yieldData = FOREST_DB.yields[species] || FOREST_DB.yields['oak_model'];
    if(species === 'evergreen') yieldData = FOREST_DB.yields['oak_model']; // ìƒë¡í™œì—½ìˆ˜ëŠ” ì°¸ë‚˜ë¬´ ì„±ì¥ ì´ìš©

    let labels = [];
    let data = [];
    let annualAbsorptions = []; // ì—°ê°„ í¡ìˆ˜ëŸ‰ ì €ì¥ (ë¯¸ë¶„)

    let prevCarbon = 0;

    for(let yr=1; yr<=years; yr++) {
        // 1. haë‹¹ ì¬ì (ë¶€í”¼) ë³´ê°„ ê³„ì‚°
        let volPerHa = getInterpolatedVolume(yieldData, yr);
        
        // 2. 1ê·¸ë£¨ë‹¹ ì¬ì  í™˜ì‚° (í‘œì¤€ ì‹ì¬ë°€ë„ 1,200ë³¸ ê°€ì •)
        let volPerTree = volPerHa / 1200;

        // 3. ì´ íƒ„ì†Œ ì €ì¥ëŸ‰ (Stock) ê³„ì‚°
        let totalCarbon = (volPerTree * count) * factor.WD * factor.BEF * (1 + factor.R) * factor.CF * (44/12);
        
        labels.push(2026 + yr);
        data.push(totalCarbon.toFixed(2));
        
        annualAbsorptions.push(totalCarbon - prevCarbon);
        prevCarbon = totalCarbon;
    }

    // ê²°ê³¼ ì—…ë°ì´íŠ¸
    const totalResult = parseFloat(data[data.length-1]);
    const avgAnnual = totalResult / years;
    
    document.getElementById('res-total').innerText = `${totalResult.toLocaleString()} tCOâ‚‚`;
    document.getElementById('res-annual').innerText = `${avgAnnual.toFixed(2)} tCOâ‚‚/yr`;
    document.getElementById('res-value').innerText = `â‚©${(totalResult * 15000).toLocaleString()}`; // í†¤ë‹¹ 1.5ë§Œì› ê°€ì •

    // 4. Comparison Impact Update
    // ìŠ¹ìš©ì°¨ 1ëŒ€ ì—°ê°„ ë°°ì¶œëŸ‰: ì•½ 2.4í†¤ (í™˜ê²½ë¶€)
    document.getElementById('imp-car').innerText = (totalResult / 2.4).toFixed(1);
    // ì¸ì²œ-ë‰´ìš• í¸ë„: ì•½ 0.9 ~ 1.2í†¤ (ICAO)
    document.getElementById('imp-flight').innerText = (totalResult / 1.0).toFixed(1);
    // ì•„ë©”ë¦¬ì¹´ë…¸ 1ì”: ì•½ 0.021kg (21g) -> í†¤ í™˜ì‚° 0.000021
    document.getElementById('imp-coffee').innerText = Math.floor(totalResult / 0.000021).toLocaleString();

    // Chart.js ê·¸ë¦¬ê¸°
    const ctx = document.getElementById('carbonChart').getContext('2d');
    if(myChart) myChart.destroy();

    myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'ëˆ„ì  íƒ„ì†Œ í¡ìˆ˜ëŸ‰ (Cumulative tCOâ‚‚)',
                data: data,
                borderColor: '#27ae60',
                backgroundColor: 'rgba(39, 174, 96, 0.1)',
                fill: true,
                tension: 0.4, // ê³¡ì„  ë¶€ë“œëŸ½ê²Œ (Spline)
                pointRadius: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: { position: 'top' },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `ëˆ„ì : ${context.parsed.y} tCOâ‚‚`;
                        }
                    }
                }
            },
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'tCOâ‚‚' } }
            }
        }
    });

    // Analyst Note Update
    updateAnalystNote(species);
}

function updateAnalystNote(species) {
    const el = document.getElementById('note-content');
    let text = "";
    
    if(species === 'tulip') {
        text = "<strong>[ë°±í•©ë‚˜ë¬´]</strong>ëŠ” ëŒ€í‘œì ì¸ ì†ì„±ìˆ˜(Fast-growing tree)ë¡œ, ì´ˆê¸° 20ë…„ ê°„ì˜ íƒ„ì†Œ í¡ìˆ˜ ì†ë„ê°€ íƒ€ ìˆ˜ì¢… ëŒ€ë¹„ 1.5~2ë°° ë¹ ë¦…ë‹ˆë‹¤. ë‹¨ê¸°ê°„ì— ESG ì„±ê³¼ë¥¼ ì°½ì¶œí•´ì•¼ í•˜ëŠ” ê¸°ì—… ì¡°ë¦¼ í”„ë¡œì íŠ¸ì— ê°€ì¥ ì í•©í•œ ì „ëµ ìˆ˜ì¢…ì…ë‹ˆë‹¤.";
    } else if(species === 'evergreen') {
        text = "<strong>[ìƒë¡í™œì—½ìˆ˜]</strong>(ê°€ì‹œë‚˜ë¬´, í›„ë°•ë‚˜ë¬´ ë“±)ëŠ” ì´ˆê¸° ì„±ì¥ì€ ë”ë””ì§€ë§Œ, ëª©ì¬ ê¸°ë³¸ë°€ë„(WD)ê°€ 0.70ìœ¼ë¡œ ë§¤ìš° ë†’ì•„ ë‹¨ìœ„ ë¶€í”¼ë‹¹ íƒ„ì†Œ ì €ì¥ íš¨ìœ¨ì´ ê°€ì¥ ë›°ì–´ë‚©ë‹ˆë‹¤. ë˜í•œ ê¸°í›„ ì˜¨ë‚œí™”ì— ë”°ë¥¸ ë‚¨ë¶€ ìˆ˜ì¢… ë¶ìƒ ê²½í–¥ì„ ê³ ë ¤í•  ë•Œ, ë¯¸ë˜ ê¸°í›„ ì ì‘(Adaptation) ì¸¡ë©´ì—ì„œ ê°€ì¥ ì•ˆì „í•œ íˆ¬ìì…ë‹ˆë‹¤.";
    } else if(species === 'larch') {
        text = "<strong>[ë‚™ì—½ì†¡]</strong>ì€ í•œêµ­ì˜ ëŒ€í‘œì ì¸ ì¡°ë¦¼ ìˆ˜ì¢…ìœ¼ë¡œ, ìƒì¥ ì†ë„ì™€ ëª©ì¬ í™œìš© ê°€ì¹˜ì˜ ë°¸ëŸ°ìŠ¤ê°€ ìš°ìˆ˜í•©ë‹ˆë‹¤. 30ë…„ ì´í›„ì—ë„ ê¾¸ì¤€í•œ í¡ìˆ˜ëŸ‰ì„ ë³´ì´ë©°, ëª©ì¬ í ë¦¿ì´ë‚˜ ê±´ì¶•ì¬ë¡œ í™œìš© ì‹œ íƒ„ì†Œ ê³ ì • íš¨ê³¼(HWP)ê¹Œì§€ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
    } else {
        text = "ì„ íƒí•˜ì‹  ìˆ˜ì¢…ì€ í•œêµ­ ì‚°ë¦¼ì˜ ì „í†µì ì¸ ìƒì¥ ê³¡ì„ ì„ ë”°ë¦…ë‹ˆë‹¤. ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ ê·¸ë˜í”„ì˜ ê¸°ìš¸ê¸°ê°€ ì™„ë§Œí•´ì§€ëŠ” ì‹œì (ë³´í†µ 40~50ë…„)ì´ ë²Œê¸°ë ¹(ìˆ˜í™• ì ê¸°)ì´ë©°, ì´ë•Œ ìˆ˜ì¢… ê°±ì‹ ì„ í†µí•´ íƒ„ì†Œ í¡ìˆ˜ì›ì„ ì¬ì°½ì¶œí•˜ëŠ” ìˆœí™˜ ê²½ì˜ì´ í•„ìš”í•©ë‹ˆë‹¤.";
    }
    el.innerHTML = text;
}

// ì´ˆê¸° ì‹¤í–‰
window.onload = runSimulation;
</script>

</body>
</html>